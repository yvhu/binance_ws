# Binance Futures Configuration
[binance]
# Trading pairs to monitor (Futures)
# Currently focused on BTC only for production trading
# To add more symbols for future expansion, simply add them to the list:
# symbols = ["BTCUSDC", "ETHUSDC", "BNBUSDC", "SOLUSDC"]
symbols = ["BTCUSDC"]
# WebSocket streams (Futures)
streams = ["ticker", "kline_5m", "kline_15m", "kline_1h"]
# Reconnection settings
reconnect_attempts = 5
reconnect_delay = 5  # seconds
# Futures type: 'perpetual' for perpetual futures
futures_type = "perpetual"

# Telegram Configuration
[telegram]
# Message settings
enable_notifications = true
message_timeout = 30  # seconds
# Rate limiting
max_messages_per_minute = 20

# Technical Indicators Configuration
[indicators]
# Moving Averages
ma_periods = [7, 25, 99]
# RSI
rsi_period = 14
rsi_overbought = 70
rsi_oversold = 30
# MACD
macd_fast = 12
macd_slow = 26
macd_signal = 9
# Bollinger Bands
bb_period = 20
bb_std = 2

# Trading Strategy Configuration
[strategy]
# 5m K线交易策略 - 优化版本
# Position size: 100% of account balance (full position)

# K线 intervals for strategy
check_interval = "5m"  # Check interval for opening position

# Early entry parameters (提前开仓参数) - 5分钟日内交易优化
early_entry_enabled = true  # Enable real-time entry (启用实时开仓)
# Real-time entry logic:
# - Check entry conditions on every K-line update (WebSocket real-time data)
# - No waiting for K-line closure
# - Immediate response to market changes

# Volume check parameters - 5分钟日内交易优化
volume_ratio_threshold = 1.0  # Minimum volume ratio (current volume / average volume of last 5 klines) - 降低到100%以允许更多信号

# K-line body ratio check parameters - 5分钟日内交易优化
body_ratio_threshold = 0.4  # Minimum body ratio (body / range), filters klines with too much resistance - 降低到40%
shadow_ratio_threshold = 0.6  # Maximum shadow ratio (shadow / range), prevents single-sided shadows from being too long - 提高到60%

# K-line range check parameters - 5分钟日内交易优化
range_ratio_threshold = 0.5  # Minimum range ratio (current range / average range of last 5 klines), ensures sufficient volatility - 降低到50%

# Stop loss parameters - 5分钟日内交易优化：收紧止损
stop_loss_range_multiplier = 0.5  # Moving stop loss distance = latest 5m K-line range * this multiplier - 降低到0.5
stop_loss_min_distance_percent = 0.008  # Minimum stop loss distance as percentage of price (0.8% = 0.008) - 降低到0.8%
stop_loss_max_distance_percent = 0.015  # Maximum stop loss distance as percentage of price (1.5% = 0.015) - 降低到1.5%
engulfing_body_ratio_threshold = 0.9  # Minimum engulfing body ratio to trigger stop loss (90% = more sensitive) - 降低到90%

# Reverse position stop loss parameters (反向开仓止损参数) - 避免连续开仓风险
reverse_position_stop_loss_enabled = false  # 启用反向开仓止损 - 当出现反向信号时立即平仓
reverse_position_check_on_entry = false  # 开仓前检查是否需要反向止损
reverse_position_check_on_kline_close = false  # K线关闭时检查是否需要反向止损
reverse_position_check_on_realtime = false  # 实时检查是否需要反向止损

# ATR-based stop loss parameters (ATR动态止损参数) - 5分钟日内交易优化
atr_stop_loss_enabled = true  # Enable ATR-based stop loss (启用ATR动态止损)
atr_stop_loss_multiplier = 1.2  # ATR multiplier for stop loss distance (ATR倍数) - 降低到1.2
atr_period = 14  # ATR period (ATR周期)

# Time-based stop loss parameters (时间止损参数) - 5分钟日内交易优化
time_stop_loss_enabled = true  # Enable time-based stop loss (启用时间止损)
time_stop_loss_klines = 5  # Maximum number of klines to hold position without profit (最大持仓K线数) - 增加到5根K线（25分钟）

# Real-time stop loss optimization parameters (实时止损优化参数) - 5分钟日内交易优化
stop_loss_price_buffer_percent = 0.001  # Price buffer to avoid false triggers (0.1% = 0.001) - 降低到0.1%
stop_loss_time_threshold = 3  # Time threshold in seconds to confirm stop loss trigger (3 seconds) - 降低到3秒
stop_loss_check_interval = 1  # Check interval in seconds (1 second)

# Trailing stop loss parameters (移动止损参数) - 5分钟日内交易优化：启用智能移动止损
trailing_stop_enabled = true  # Enable trailing stop loss (移动止损开关) - 启用移动止损
trailing_stop_kline_count = 2  # Number of recent klines to use for trailing stop (使用最近N根K线的最低/最高点) - 降低到2根K线

# Profit drawdown protection (利润回撤保护) - 防止利润过度回吐
profit_drawdown_protection_enabled = true  # 启用利润回撤保护
profit_drawdown_threshold_percent = 0.01  # 触发回撤保护的最低利润比例 (1%)
max_profit_drawdown_percent = 0.005  # 最大允许回撤比例 (0.5%) - 达到目标利润后，最多回撤0.5%

# Dynamic trailing stop distance (动态移动止损距离) - 根据利润水平调整止损距离
dynamic_trailing_distance_enabled = true  # 启用动态移动止损距离
# 阶梯式移动止损配置
trailing_profit_levels = [0.01, 0.015, 0.02]  # 利润阈值 [1%, 1.5%, 2%]
trailing_distance_levels = [0.003, 0.005, 0.008]  # 对应的移动止损距离 [0.3%, 0.5%, 0.8%]

# Take profit parameters (止盈参数) - 5分钟日内交易优化：降低止盈目标
take_profit_enabled = true  # Enable take profit (止盈开关)
take_profit_percent = 0.025  # Take profit threshold as percentage of entry price (2.5% = 0.025) - 降低到2.5%
take_profit_trailing_enabled = true  # Enable trailing take profit after reaching take profit (移动止盈开关)
take_profit_trailing_percent = 0.01  # Trailing take profit threshold (1% = 0.01) - 降低到1%

# Partial take profit parameters (分批止盈参数) - 5分钟日内交易优化
partial_take_profit_enabled = true  # Enable partial take profit (启用分批止盈)
partial_take_profit_levels = [0.015, 0.025]  # Take profit levels as percentages [1.5%, 2.5%] - 调整为1.5%和2.5%
partial_take_profit_ratios = [0.5, 0.5]  # Ratios to close at each level [50%, 50%]

# Trend filter parameters (to avoid false breakouts in sideways markets) - 5分钟日内交易优化
trend_filter_enabled = true  # Enable trend filter to avoid false breakouts
trend_filter_ma_period = 7  # MA period for trend filter (default: 7) - 使用MA7，更敏感
# Trend filter logic:
# - For LONG: price must be ABOVE MA7 AND MA7 must be trending UP
# - For SHORT: price must be BELOW MA7 AND MA7 must be trending DOWN
# This helps avoid false breakouts in sideways markets

# Sideways market filter (横盘市场过滤) - 放宽条件
sideways_market_filter_enabled = false  # 暂时禁用横盘市场过滤，允许更多信号
sideways_market_adx_threshold = 15  # ADX阈值，降低到15以允许更多信号
min_trend_strength = 0.1  # 最小趋势强度要求，降低到0.1

# Signal quality filter (信号质量过滤) - 放宽条件
signal_confirmation_enabled = false  # 暂时禁用信号确认，允许更多信号
signal_confirmation_klines = 1  # 降低到1根K线确认
min_signal_strength = "WEAK"  # 接受所有信号强度

# Volume confirmation (成交量确认) - 放宽条件
volume_confirmation_enabled = false  # 暂时禁用成交量确认，允许更多信号
volume_confirmation_klines = 1  # 降低到1根K线确认

# Additional indicator filters (额外指标过滤) - 5分钟日内交易优化：只保留核心过滤器
rsi_filter_enabled = true  # Enable RSI filter (启用RSI过滤)
rsi_long_max = 75  # Maximum RSI for long entry (做多时RSI最大值) - 放宽到75
rsi_short_min = 25  # Minimum RSI for short entry (做空时RSI最小值) - 放宽到25

# Trading Configuration
[trading]
# Fee rate (0.0002 = 0.02%, 0.0004 = 0.04%)
# Binance futures default fee: 0.02% (maker) / 0.04% (taker)
# Using maker fee for limit orders (default)
fee_rate = 0.0002  # 0.02% for limit orders (maker fee)

# Safety margin (extra buffer to ensure order can be filled)
# 0.003 = 0.3% extra margin (reduced for small balance accounts)
safety_margin = 0.003  # 0.3% safety margin

# Limit order configuration
[trading.limit_order]
# Enable limit orders
enabled = true  # 启用限价单交易

# Entry limit order configuration
entry_limit_order_enabled = true  # 启用开仓限价单
entry_price_offset_percent = 0.002  # 开仓价格偏移 0.2% - 增加以提高成交率
entry_price_offset_max_percent = 0.003  # 最大偏移 0.3% - 增加以提高成交率
entry_use_support_resistance = true  # 使用支撑/阻力位
entry_support_resistance_lookback = 5  # 回看K线数

# Entry monitoring
entry_price_away_threshold = 0.005  # 价格远离阈值 0.5%
entry_limit_order_timeout = 60  # 限价单超时时间（秒）- 增加到60秒以提高成交率
entry_rapid_price_change_threshold = 0.003  # 快速价格变化阈值 0.3%
entry_rapid_price_change_window = 5  # 快速变化时间窗口（秒）

# Take profit limit order configuration
take_profit_limit_order_enabled = true  # 启用止盈限价单
take_profit_price_offset = 0.001  # 止盈价格偏移 0.1%
take_profit_price_away_threshold = 0.005  # 止盈价格远离阈值 0.5%
take_profit_limit_order_timeout = 60  # 止盈限价单超时时间（秒）

# Stop loss configuration (always use market order)
stop_loss_use_market_order = true  # 止损使用市价单
emergency_close_threshold = 0.002  # 紧急平仓阈值 0.2%

# Monitoring configuration
monitor_check_interval = 1  # 监控检查间隔（秒）
emergency_check_interval = 0.5  # 紧急监控检查间隔（秒）

# 未完成订单处理策略
action_on_timeout = "convert_to_market"  # 超时时的处理方式: "convert_to_market" (转换为市价单) 或 "cancel" (取消订单)
action_on_signal_reversal = "cancel"   # 信号反转时的处理方式: "convert_to_market" 或 "cancel"
cancel_on_new_signal = true             # 检测到新信号时是否取消旧的限价单
max_pending_orders = 1                  # 每个交易对最大挂单数量
cancel_on_kline_close = false           # K线关闭时是否取消未成交的限价单
cancel_on_price_move_away = true        # 价格远离时是否取消限价单（如果action_on_timeout为cancel）

# Risk control configuration (风险控制配置)
max_price_deviation_percent = 0.005    # 最大价格偏差 0.5%
max_stop_loss_distance_percent = 0.02  # 最大止损距离 2%
min_stop_loss_distance_percent = 0.005 # 最小止损距离 0.5%
volatility_threshold = 0.02             # 波动率阈值 2%
volume_threshold_multiplier = 0.5       # 成交量阈值倍数 0.5x

# Risk Management - 优化：降低单笔风险，优化仓位管理
# Maximum loss per trade as percentage of account balance
# This limits the position size based on stop loss distance
# Example: With 5% max loss and 2.5% stop loss distance, position size = 2x leverage
max_loss_per_trade_percent = 0.05  # 5% maximum loss per trade - 降低到5%，更保守

# Position sizing based on signal strength (基于信号强度的仓位分级) - 5分钟日内交易优化：降低仓位比例
strong_signal_position_ratio = 0.5  # 50% position for strong signals - 降低到50%
medium_signal_position_ratio = 0.3  # 30% position for medium signals - 降低到30%
weak_signal_position_ratio = 0.2  # 20% position for weak signals - 降低到20%

# Drawdown protection parameters (回撤保护参数) - 5分钟日内交易优化
drawdown_protection_enabled = false  # Enable drawdown protection (启用回测保护) - 已关闭
max_consecutive_losses = 5  # Maximum consecutive losses before pausing trading (最大连续亏损次数) - 提高到5次
max_daily_loss_percent = 0.08  # Maximum daily loss as percentage of account balance (最大日亏损比例8%) - 提高到8%
position_reduction_on_loss = 0.3  # Position reduction factor after consecutive losses (连续亏损后仓位缩减比例30%) - 降低到30%
trading_pause_duration = 1800  # Trading pause duration in seconds after max consecutive losses (连续亏损后暂停交易时长1800秒=30分钟) - 缩短到30分钟
# Drawdown protection logic:
# - Track consecutive losses and daily losses
# - Pause trading after max consecutive losses
# - Reduce position size after consecutive losses
# - Stop trading for the day if daily loss exceeds threshold

# Logging Configuration
[logging]
level = "INFO"
format = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
file = "logs/app.log"
max_bytes = 10485760  # 10MB
backup_count = 5