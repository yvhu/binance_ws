# Binance Futures Configuration
[binance]
# Trading pairs to monitor (Futures)
# Currently focused on BTC only for production trading
# To add more symbols for future expansion, simply add them to the list:
# symbols = ["BTCUSDC", "ETHUSDC", "BNBUSDC", "SOLUSDC"]
symbols = ["BTCUSDC"]
# WebSocket streams (Futures)
streams = ["ticker", "kline_5m"]
# Reconnection settings
reconnect_attempts = 5
reconnect_delay = 5  # seconds
# Futures type: 'perpetual' for perpetual futures
futures_type = "perpetual"

# Telegram Configuration
[telegram]
# Message settings
enable_notifications = true
message_timeout = 30  # seconds
# Rate limiting
max_messages_per_minute = 20

# Technical Indicators Configuration
[indicators]
# Moving Averages
ma_periods = [7, 25, 99]
# RSI
rsi_period = 14
rsi_overbought = 70
rsi_oversold = 30
# MACD
macd_fast = 12
macd_slow = 26
macd_signal = 9
# Bollinger Bands
bb_period = 20
bb_std = 2

# Trading Strategy Configuration
[strategy]
# 5m K线交易策略 - 优化版本
# Position size: 100% of account balance (full position)

# K线 intervals for strategy
check_interval = "5m"  # Check interval for opening position

# Early entry parameters (提前开仓参数)
early_entry_enabled = false  # Enable early entry before K-line closes (启用提前开仓)
early_entry_min_progress = 0.7  # Minimum K-line progress to check early entry (70% = 0.7)
early_entry_strong_signal_only = true  # Only early entry for strong signals (仅强信号提前开仓)
# Early entry logic:
# - Check entry conditions when K-line progress reaches threshold (e.g., 70%)
# - Only early entry if all conditions are met and signal is strong
# - Helps get better entry price by entering earlier
# - Risk: K-line may reverse before closing, so only use with strong signals

# Entry confirmation parameters (入场确认参数)
entry_confirmation_enabled = true  # Enable entry confirmation mechanism (启用入场确认机制)
entry_confirmation_type = "price"  # Confirmation type: "price" (价格确认), "volume" (成交量确认), "both" (两者都确认)
entry_confirmation_wait_klines = 1  # Number of klines to wait for confirmation (等待确认的K线数)
entry_confirmation_price_threshold = 0.002  # Price confirmation threshold (0.2% = 0.002) - 价格确认阈值
entry_confirmation_volume_threshold = 1.1  # Volume confirmation threshold (1.1 = 110%) - 成交量确认阈值
# Entry confirmation logic:
# - Price confirmation: Price must continue in the expected direction by at least threshold
# - Volume confirmation: Volume must be at least threshold times average
# - Wait for next kline to confirm the signal is not a fake breakout
# - Reduces false signals and improves win rate

# Volume check parameters - 优化：提高阈值以过滤弱信号
volume_ratio_threshold = 1.2  # Minimum volume ratio (current volume / average volume of last 5 klines) - 提高到120%，确保成交量放大

# K-line body ratio check parameters - 优化：提高阈值以过滤假突破
body_ratio_threshold = 0.7  # Minimum body ratio (body / range), filters klines with too much resistance - 提高到70%，确保K线实体足够大
shadow_ratio_threshold = 0.4  # Maximum shadow ratio (shadow / range), prevents single-sided shadows from being too long - 降低到40%，更严格

# K-line range check parameters - 优化：提高阈值以确保足够的波动性
range_ratio_threshold = 0.8  # Minimum range ratio (current range / average range of last 5 klines), ensures sufficient volatility - 提高到80%，确保足够的波动性

# Stop loss parameters - 优化：使用ATR动态止损，提高止损距离以容纳正常波动
stop_loss_range_multiplier = 0.8  # Moving stop loss distance = latest 5m K-line range * this multiplier - 提高到0.8
stop_loss_min_distance_percent = 0.025  # Minimum stop loss distance as percentage of price (2.5% = 0.025) - 提高到2.5%
stop_loss_max_distance_percent = 0.04  # Maximum stop loss distance as percentage of price (4% = 0.04) - 提高到4%
engulfing_body_ratio_threshold = 0.95  # Minimum engulfing body ratio to trigger stop loss (95% = less sensitive) - 保持95%

# ATR-based stop loss parameters (ATR动态止损参数)
atr_stop_loss_enabled = true  # Enable ATR-based stop loss (启用ATR动态止损)
atr_stop_loss_multiplier = 2.0  # ATR multiplier for stop loss distance (ATR倍数) - 提高到2.0
atr_period = 14  # ATR period (ATR周期)

# Time-based stop loss parameters (时间止损参数)
time_stop_loss_enabled = true  # Enable time-based stop loss (启用时间止损)
time_stop_loss_klines = 6  # Maximum number of klines to hold position without profit (最大持仓K线数) - 延长到6根K线（30分钟）

# Real-time stop loss optimization parameters (实时止损优化参数)
# 优化后的配置，减少误触发同时保持及时止损
stop_loss_price_buffer_percent = 0.002  # Price buffer to avoid false triggers (0.2% = 0.002) - 优化后配置
stop_loss_time_threshold = 5  # Time threshold in seconds to confirm stop loss trigger (5 seconds) - 优化后配置
stop_loss_check_interval = 1  # Check interval in seconds (1 second)

# Trailing stop loss parameters (移动止损参数)
trailing_stop_enabled = false  # Enable trailing stop loss (移动止损开关) - 禁用移动止损，避免与实时监控止损冲突
trailing_stop_kline_count = 5  # Number of recent klines to use for trailing stop (使用最近N根K线的最低/最高点) - 增加到5根K线

# Take profit parameters (止盈参数) - 优化：提高止盈比例，改善风险收益比
# 优化配置：止损2.5%-4%，止盈8%，风险/收益比2:1以上，适合5分钟K线周期
take_profit_enabled = true  # Enable take profit (止盈开关)
take_profit_percent = 0.08  # Take profit threshold as percentage of entry price (8% = 0.08) - 提高到8%
take_profit_trailing_enabled = true  # Enable trailing take profit after reaching take profit (移动止盈开关)
take_profit_trailing_percent = 0.025  # Trailing take profit threshold (2.5% = 0.025) - 提高到2.5%

# Partial take profit parameters (分批止盈参数)
partial_take_profit_enabled = true  # Enable partial take profit (启用分批止盈)
partial_take_profit_levels = [0.05, 0.08]  # Take profit levels as percentages [5%, 8%] - 调整为5%和8%
partial_take_profit_ratios = [0.5, 0.5]  # Ratios to close at each level [50%, 50%]

# Dynamic take profit parameters (动态止盈参数)
dynamic_take_profit_enabled = true  # Enable dynamic take profit based on trend strength (启用动态止盈)
strong_trend_take_profit_percent = 0.12  # Take profit for strong trend (12%) - 提高到12%
weak_trend_take_profit_percent = 0.05  # Take profit for weak trend (5%) - 提高到5%
adx_trend_threshold = 25  # ADX threshold for trend strength (ADX趋势强度阈值)

# Trend filter parameters (to avoid false breakouts in sideways markets)
trend_filter_enabled = true  # Enable trend filter to avoid false breakouts
trend_filter_ma_period = 20  # MA period for trend filter (default: 20)
# Trend filter logic:
# - For LONG: price must be ABOVE MA20 AND MA20 must be trending UP
# - For SHORT: price must be BELOW MA20 AND MA20 must be trending DOWN
# This helps avoid false breakouts in sideways markets

# Additional indicator filters (额外指标过滤) - 优化：收紧过滤器阈值
rsi_filter_enabled = true  # Enable RSI filter (启用RSI过滤)
rsi_long_max = 60  # Maximum RSI for long entry (做多时RSI最大值) - 降低到60，避免在超买区做多
rsi_short_min = 40  # Minimum RSI for short entry (做空时RSI最小值) - 提高到40，避免在超卖区做空

macd_filter_enabled = true  # Enable MACD filter (启用MACD过滤)
# MACD filter logic:
# - For LONG: MACD histogram > 0 OR bullish crossover
# - For SHORT: MACD histogram < 0 OR bearish crossover

adx_filter_enabled = true  # Enable ADX filter for trend strength (启用ADX趋势强度过滤)
adx_min_trend = 25  # Minimum ADX for trend market (趋势市场最小ADX) - 提高到25，确保有足够趋势
adx_sideways = 20  # ADX threshold for sideways market (震荡市场ADX阈值)

# Market environment recognition parameters (市场环境识别参数) - 优化：提高信心分数，禁止震荡市交易
market_env_filter_enabled = true  # Enable market environment filter (启用市场环境过滤)
market_env_allow_ranging = false  # Allow trading in ranging markets (允许在震荡市交易) - 禁用，避免在震荡市交易
market_env_min_confidence = 70  # Minimum confidence score for market environment (市场环境最小信心分数) - 提高到70
market_env_adx_trend_threshold = 25  # ADX threshold for trend market (趋势市场ADX阈值)
market_env_adx_strong_threshold = 40  # ADX threshold for strong trend (强趋势ADX阈值)
# Market environment recognition logic:
# - Uses ADX, MA direction, and volatility to identify market type
# - Trending market: ADX >= 25, MA aligned with price direction
# - Ranging market: ADX < 25, price oscillating around MA
# - Confidence score: 0-100, based on multiple factors
# - Low confidence (<70%) reduces signal strength

# Multi-timeframe analysis parameters (多周期分析参数) - 优化：启用多周期分析
multi_timeframe_enabled = true  # Enable multi-timeframe analysis (启用多周期分析) - 启用
multi_timeframe_intervals = ["15m", "1h"]  # Timeframes to analyze (分析的时间周期)
multi_timeframe_require_alignment = true  # Require trend alignment across timeframes (要求多周期趋势一致)
multi_timeframe_min_aligned = 2  # Minimum number of timeframes that must align (至少需要多少个周期一致)
# Multi-timeframe analysis logic:
# - Analyzes trend direction on 15m and 1h timeframes
# - Only opens position if trends align across timeframes
# - Helps filter out false signals and improves win rate
# - Example: 5m LONG signal + 15m UP trend + 1h UP trend = Strong LONG signal

# Sentiment indicator parameters (情绪指标参数)
sentiment_filter_enabled = false  # Enable sentiment filter (启用情绪指标过滤)
sentiment_min_fear = 25  # Minimum fear level to allow long entry (做多时最小恐惧值)
sentiment_max_greed = 75  # Maximum greed level to allow long entry (做多时最大贪婪值)
sentiment_min_greed = 56  # Minimum greed level to allow short entry (做空时最小贪婪值)
sentiment_max_fear = 44  # Maximum fear level to allow short entry (做空时最大恐惧值)

# Machine Learning predictor parameters (机器学习预测器参数)
ml_filter_enabled = false  # Enable ML filter (启用机器学习过滤)
ml_min_confidence = 0.6  # Minimum confidence required for ML prediction (ML预测所需最小置信度)
ml_train_on_startup = true  # Train ML model on startup (启动时训练ML模型)
ml_retrain_interval = 24  # Retrain model every N hours (每N小时重新训练模型)
# Sentiment indicator logic:
# - Fear and Greed Index ranges from 0 (Extreme Fear) to 100 (Extreme Greed)
# - 0-24: Extreme Fear (极度恐惧) - Good for LONG entry
# - 25-44: Fear (恐惧) - Good for LONG entry
# - 45-55: Neutral (中性) - No restriction
# - 56-75: Greed (贪婪) - Good for SHORT entry
# - 76-100: Extreme Greed (极度贪婪) - Good for SHORT entry
# - LONG entry: Only when sentiment <= sentiment_max_greed (avoid extreme greed)
# - SHORT entry: Only when sentiment >= sentiment_min_greed (avoid extreme fear)

# Trading Configuration
[trading]
# Fee rate (0.0002 = 0.02%, 0.0004 = 0.04%)
# Binance futures default fee: 0.02% (maker) / 0.04% (taker)
# Using maker fee for limit orders (default)
fee_rate = 0.0002  # 0.02% for limit orders (maker fee)

# Safety margin (extra buffer to ensure order can be filled)
# 0.003 = 0.3% extra margin (reduced for small balance accounts)
safety_margin = 0.003  # 0.3% safety margin

# Limit order configuration
[trading.limit_order]
# Enable limit orders
enabled = true  # 启用限价单交易

# Entry limit order configuration
entry_limit_order_enabled = true  # 启用开仓限价单
entry_price_offset_percent = 0.001  # 开仓价格偏移 0.1%
entry_price_offset_max_percent = 0.002  # 最大偏移 0.2%
entry_use_support_resistance = true  # 使用支撑/阻力位
entry_support_resistance_lookback = 5  # 回看K线数

# Entry monitoring
entry_price_away_threshold = 0.005  # 价格远离阈值 0.5%
entry_limit_order_timeout = 30  # 限价单超时时间（秒）
entry_rapid_price_change_threshold = 0.003  # 快速价格变化阈值 0.3%
entry_rapid_price_change_window = 5  # 快速变化时间窗口（秒）

# Take profit limit order configuration
take_profit_limit_order_enabled = true  # 启用止盈限价单
take_profit_price_offset = 0.001  # 止盈价格偏移 0.1%
take_profit_price_away_threshold = 0.005  # 止盈价格远离阈值 0.5%
take_profit_limit_order_timeout = 60  # 止盈限价单超时时间（秒）

# Stop loss configuration (always use market order)
stop_loss_use_market_order = true  # 止损使用市价单
emergency_close_threshold = 0.002  # 紧急平仓阈值 0.2%

# Monitoring configuration
monitor_check_interval = 1  # 监控检查间隔（秒）
emergency_check_interval = 0.5  # 紧急监控检查间隔（秒）

# 未完成订单处理策略
action_on_timeout = "convert_to_market"  # 超时时的处理方式: "convert_to_market" (转换为市价单) 或 "cancel" (取消订单)
action_on_signal_reversal = "cancel"   # 信号反转时的处理方式: "convert_to_market" 或 "cancel"
cancel_on_new_signal = true             # 检测到新信号时是否取消旧的限价单
max_pending_orders = 1                  # 每个交易对最大挂单数量
cancel_on_kline_close = false           # K线关闭时是否取消未成交的限价单
cancel_on_price_move_away = true        # 价格远离时是否取消限价单（如果action_on_timeout为cancel）

# Risk control configuration (风险控制配置)
max_price_deviation_percent = 0.005    # 最大价格偏差 0.5%
max_stop_loss_distance_percent = 0.02  # 最大止损距离 2%
min_stop_loss_distance_percent = 0.005 # 最小止损距离 0.5%
volatility_threshold = 0.02             # 波动率阈值 2%
volume_threshold_multiplier = 0.5       # 成交量阈值倍数 0.5x

# Risk Management - 优化：降低单笔风险，优化仓位管理
# Maximum loss per trade as percentage of account balance
# This limits the position size based on stop loss distance
# Example: With 5% max loss and 2.5% stop loss distance, position size = 2x leverage
max_loss_per_trade_percent = 0.05  # 5% maximum loss per trade - 降低到5%，更保守

# Position sizing based on signal strength (基于信号强度的仓位分级) - 优化：降低仓位比例
strong_signal_position_ratio = 0.8  # 80% position for strong signals - 降低到80%
medium_signal_position_ratio = 0.6  # 60% position for medium signals - 降低到60%
weak_signal_position_ratio = 0.4  # 40% position for weak signals - 降低到40%

# Drawdown protection parameters (回撤保护参数)
drawdown_protection_enabled = true  # Enable drawdown protection (启用回撤保护)
max_consecutive_losses = 3  # Maximum consecutive losses before pausing trading (最大连续亏损次数)
max_daily_loss_percent = 0.05  # Maximum daily loss as percentage of account balance (最大日亏损比例5%)
position_reduction_on_loss = 0.5  # Position reduction factor after consecutive losses (连续亏损后仓位缩减比例50%)
trading_pause_duration = 3600  # Trading pause duration in seconds after max consecutive losses (连续亏损后暂停交易时长3600秒=1小时)
# Drawdown protection logic:
# - Track consecutive losses and daily losses
# - Pause trading after max consecutive losses
# - Reduce position size after consecutive losses
# - Stop trading for the day if daily loss exceeds threshold

# Logging Configuration
[logging]
level = "INFO"
format = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
file = "logs/app.log"
max_bytes = 10485760  # 10MB
backup_count = 5